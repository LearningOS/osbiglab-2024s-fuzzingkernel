# Chapter 6 & 7

## 功能

- `sys_linkat` 和 `sys_unlinkat`
  - 在 `DiskInode` 中用一个 `u32` 维护硬链接的引用计数。为此需要减少一个直接索引数据块，使 `DiskInode` 的大小不变。
  - 添加了 `EasyFileSystemError`，表示 EasyFS 可能产生的错误。使用 `Result<T, EasyFileSystemError>` 作为返回结果，向调用者提供错误信息。
  - 创建链接通过 `vfs::Inode::link` 实现。首先从根节点的目录项中找到要链接的文件的索引节点编号（Inode ID），索引到相应的 `DiskInode` 并增加其引用计数；然后在根节点下用新的名字创建目录项，并指向该索引节点。如果未找到文件或重名则报错。
  - 删除链接通过 `vfs::Inode::unlink` 实现。首先从根节点的目录项中找到要链接的文件的索引节点编号，索引到相应的 `DiskInode` 并减少其引用计数，当引用计数归零时回收其数据块；然后在根节点下删除对应的目录项。如果未找到文件则报错。
  
- `sys_stat`
  - 实现硬链接时，`DiskInode` 已经添加了引用计数。在 `vfs::Inode` 中维护索引节点编号。
  - 获取信息通过 `vfs::Inode::stat` 实现。内部实现是从 `DiskInode` 和 `Inode` 自身获取信息。

## 简答

### Root Inode

1. Inode 是文件系统中重要的数据结构之一。它维护了逻辑目录树的拓扑结构，与目录树的文件和目录一一对应，还保存了文件的元数据和实际数据的索引信息。root inode 是整个目录树的根节点的实现，索引任何文件、获取任何数据都必须从根节点出发。如果 root inode 损坏，就会失去索引文件、获取数据的功能，造成整个文件系统损坏。

### Pipe

1. 将各种命令行工具的输出结果通过 pipe 传递给 `grep`，可以筛选想要的信息。
2. 设计一种以进程组为单位进行管理的通信方式，组内任意二者均可互相通信。进程向内核申请加入或退出通信组，内核负责将相应的信息广播给该组的其它成员。内核为每个进程维护一个缓冲区，存放来自其它进程的消息。

## Honor Code

- 在完成本次实验的过程（含此前学习的过程）中，我曾分别与 **以下各位** 就（与本次实验相关的）以下方面做过交流，还在代码中对应的位置以注释形式记录了具体的交流对象及内容：

  > 无

- 此外，我也参考了 **以下资料** ，还在代码中对应的位置以注释形式记录了具体的参考来源及内容：

  > 去年个人独立完成的实验：
  >
  > [李羽飞 / rCore-Tutorial-2023S · GitLab (tsinghua.edu.cn)](https://git.tsinghua.edu.cn/liyufei21/rcore-tutorial-2023s)
  >
  > 
  >

- 我独立完成了本次实验除以上方面之外的所有工作，包括代码与文档。 我清楚地知道，从以上方面获得的信息在一定程度上降低了实验难度，可能会影响起评分。

- 我从未使用过他人的代码，不管是原封不动地复制，还是经过了某些等价转换。 我未曾也不会向他人（含此后各届同学）复制或公开我的实验代码，我有义务妥善保管好它们。 我提交至本实验的评测系统的代码，均无意于破坏或妨碍任何计算机系统的正常运转。 我清楚地知道，以上情况均为本课程纪律所禁止，若违反，对应的实验成绩将按“-100”分计。
